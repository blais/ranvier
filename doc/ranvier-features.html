<?xml version="1.0" encoding="iso-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
<title>urlmaps: Mapping URLs in Web Applications</title>
<meta name="author" content="Martin Blais &lt;blais&#64;furius.ca&gt;" />
<meta name="date" content="2006-04-11" />
<link rel="stylesheet" href="../style.css" type="text/css" />
</head>
<body>

<div id="project-header">
  <a href="/"><img src="/home/furius-logo-w.png" id="logo"></a>
  <div id="project-home"><a href="..">Project Home</a></div>
</div>

<div class="document" id="urlmaps-mapping-urls-in-web-applications">
<h1 class="title">urlmaps: Mapping URLs in Web Applications</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Author:</th>
<td>Martin Blais &lt;<a class="reference" href="mailto:blais&#64;furius.ca">blais&#64;furius.ca</a>&gt;</td></tr>
<tr><th class="docinfo-name">Date:</th>
<td>2006-04-11</td></tr>
</tbody>
</table>
<div class="abstract topic">
<p class="topic-title first">Abstract</p>
<p>(Unfinished) Documentation on the Ranvier URL mapping system.</p>
</div>
<div class="contents topic">
<p class="topic-title first"><a id="contents" name="contents">Contents</a></p>
<ul class="auto-toc simple">
<li><a class="reference" href="#introduction" id="id3" name="id3">1&nbsp;&nbsp;&nbsp;Introduction</a></li>
<li><a class="reference" href="#problem-statement-and-domains" id="id4" name="id4">2&nbsp;&nbsp;&nbsp;Problem Statement and Domains</a></li>
<li><a class="reference" href="#mapping-forward" id="id5" name="id5">3&nbsp;&nbsp;&nbsp;Mapping Forward</a><ul class="auto-toc">
<li><a class="reference" href="#chain-of-responsibility" id="id6" name="id6">3.1&nbsp;&nbsp;&nbsp;Chain of Responsibility</a></li>
<li><a class="reference" href="#naming-of-resources" id="id7" name="id7">3.2&nbsp;&nbsp;&nbsp;Naming of Resources</a></li>
</ul>
</li>
<li><a class="reference" href="#mapping-backward" id="id8" name="id8">4&nbsp;&nbsp;&nbsp;Mapping Backward</a><ul class="auto-toc">
<li><a class="reference" href="#optimization-of-backmapping" id="id9" name="id9">4.1&nbsp;&nbsp;&nbsp;Optimization of BackMapping</a></li>
<li><a class="reference" href="#selection-of-resource-ids" id="id10" name="id10">4.2&nbsp;&nbsp;&nbsp;Selection of Resource Ids</a></li>
<li><a class="reference" href="#static-maps" id="id11" name="id11">4.3&nbsp;&nbsp;&nbsp;Static Maps</a></li>
<li><a class="reference" href="#unique-identifiers" id="id12" name="id12">4.4&nbsp;&nbsp;&nbsp;Unique Identifiers</a></li>
</ul>
</li>
<li><a class="reference" href="#listing-available-resources-and-urls" id="id13" name="id13">5&nbsp;&nbsp;&nbsp;Listing Available Resources and URLs</a></li>
<li><a class="reference" href="#embedding-security" id="id14" name="id14">6&nbsp;&nbsp;&nbsp;Embedding Security</a></li>
<li><a class="reference" href="#internal-redirects" id="id15" name="id15">7&nbsp;&nbsp;&nbsp;Internal Redirects</a></li>
<li><a class="reference" href="#support-for-debugging" id="id16" name="id16">8&nbsp;&nbsp;&nbsp;Support for Debugging</a></li>
<li><a class="reference" href="#a-routes-like-interface" id="id17" name="id17">9&nbsp;&nbsp;&nbsp;A Routes-Like Interface</a></li>
<li><a class="reference" href="#other" id="id18" name="id18">10&nbsp;&nbsp;&nbsp;(Other)</a><ul class="auto-toc">
<li><a class="reference" href="#writing-tests" id="id19" name="id19">10.1&nbsp;&nbsp;&nbsp;Writing Tests</a></li>
</ul>
</li>
</ul>
</div>
<!-- 1   Introduction
2   Problem Statement and Domains
3   Mapping Forward
  3.1  Chain of Responsibility
  3.2  Naming of Resources
4   Mapping Backward
  4.1  Optimization of BackMapping
  4.2  Selection of Resource Ids
  4.3  Static Maps
  4.4  Unique Identifiers
5   Listing Available Resources and URLs
6   Embedding Security
7   Internal Redirects
8   Support for Debugging
9   A Routes-Like Interface
10  (Other)
  10.1  Writing Tests -->
<div class="section">
<h1><a class="toc-backref" href="#id3" id="introduction" name="introduction">1&nbsp;&nbsp;&nbsp;Introduction</a></h1>
<p>Mapping URLs is an important component of building web applications.
&#8230;
(FIXME add more)</p>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id4" id="problem-statement-and-domains" name="problem-statement-and-domains">2&nbsp;&nbsp;&nbsp;Problem Statement and Domains</a></h1>
<p>Let's consider some of the important parts of a typical web application
framework:</p>
<ol class="arabic simple">
<li>Code that serves pages or performs a specific task when a URL is
requested.  Let's call the documents served <strong>resources</strong> and the code that
serves than <strong>resource handlers</strong>;</li>
<li>There is usually a way to <strong>combine</strong> the resource handlers to take advantage
of common functionality.  For example, code that fetches a user's preferences
may be needed in many places, and we would like to write the code once.  This
could be as simple as allowing the definition of functions, or the
elaboration of a complex hierarchical object-based system.  This could be
done via aggregation/composition or inheritance, or using other paradigms;</li>
<li><strong>Pattern matching the URL</strong> to select a particular resource handler to map it
to;</li>
<li><strong>Capturing and validating</strong> the variable components and the query arguments
from the URL request string and provide them to the resource handler.  This
is a task similar to <strong>parsing</strong>;</li>
<li><strong>Rendering other URLs back to the user</strong>.  These are actually <strong>delayed
function calls</strong>, which depend on the user's future actions.</li>
</ol>
<div class="figure">
<img alt="domains.png" src="domains.png" />
<p class="caption">The principal goal of this library is to convert between the domain of URLs
and the domain of code objects (resource handlers).</p>
</div>
<p>You can view this problem as mapping back and forth between two domains: the
domain of URLs and the domain of source code.  As programmers, we should have
little concern for the particular URLs that our resources are accessed from, if
not for the correspondence between URL variable components and function
parameters, or for purely aesthetic reasons.</p>
<p>All we need is some kind of system for uniquely identifying resources, and
rendering the appropriate URL given its parameters.  Most computer languages
provide some form or other of checking of parameter correctness when making
function calls.  Is it not silly then, that most web application
frameworks&#8212;especially those based on templates&#8212;still involve the programmer in
writing URLs when rendering pages?</p>
<p>The goals of this library are:</p>
<ul class="simple">
<li>To isolate the programmer's interface from the specifics URLs that the
cross-referenced resources are bound to;</li>
<li>To provide a system that better manages the list of resources that are
available from a web application, that can list them, serve them for test
programs, etc.</li>
<li>To implement a simple but efficient forward mapping parsing mechanism based on
aggregation of resources (the <a class="reference" href="http://en.wikipedia.org/wiki/Chain-of-responsibility_pattern">chain-of-responsibility design pattern</a>).</li>
</ul>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id5" id="mapping-forward" name="mapping-forward">3&nbsp;&nbsp;&nbsp;Mapping Forward</a></h1>
<p>We can view URLs are function calls into a running computer program, i.e:</p>
<pre class="literal-block">
http://mysite.com/accounts/get_balance?user=blais&amp;accno=643843
</pre>
<p>maps in a web application into a call to some function <tt class="docutils literal"><span class="pre">get_balance</span></tt> with two
parameters, <em>user</em> and <em>accno</em>:</p>
<pre class="literal-block">
def get_balance( user, accno ):
    ...
</pre>
<p>This view is similar to the event loop model of desktop applications, where the
idle event loop consists of a server waiting for requests.  (The difference is
that the web's event loop serves multiple users and therefore must maintain
per-user global state, this is what we call <em>session data</em>, and it is
implemented using cookies, that a user's browser serves back to the server).</p>
<p>In the preceding example, the parameters were obvious, they were embedded in the
query arguments.  However, any part of the URL can be an argument:</p>
<pre class="literal-block">
http://mysite.com/users/blais/acc/643843/get_balance/
</pre>
<p>This tends to produce nicer URLs and bends the user into conceptually organizing
the resources he makes available on his server in a hierarchy.  Query arguments
are best reserved for optional arguments.</p>
<p>Within this view, we can easily explain the concept of <a class="reference" href="http://en.wikipedia.org/wiki/Representational_State_Transfer">RESTfulness</a>: a resource
is said to comply to the principles of REST if it is not significantly affected
by global variables / side-effects, i.e. if it does not rely on global
state/variables as input.</p>
<p>One consequence of using our system is that we do not render <em>relative</em> URLs,
i.e. all the URLs are from the root.  This consists in an advantage:  FIXME add
more</p>
<div class="section">
<h2><a class="toc-backref" href="#id6" id="chain-of-responsibility" name="chain-of-responsibility">3.1&nbsp;&nbsp;&nbsp;Chain of Responsibility</a></h2>
<p>(FIXME explain resource system and pattern matching algorithm)</p>
<p>One of the advantages in using a Chain of Responsibility pattern to implement
the controller search is that complete flexibility is available to the
programmer.  We have no need to define a complicated and necessarily limited
wildcard matching system.  The matching of URL components is entirely up to you,
i.e. you can look up information in a database, augment the context object that
is passed along the search, etc.  This is much more powerful (and simpler) than
a wildcard system.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id7" id="naming-of-resources" name="naming-of-resources">3.2&nbsp;&nbsp;&nbsp;Naming of Resources</a></h2>
<p>The overwhelmingly general case for leaf resources/controllers is that they are
instantiated only once.  We thus take the opportunity to forego having the user
enter resource names for each of these.  Instead, we reuse the names of the
classes of the leaf controllers to enter them in the URL map.</p>
<p>For those few cases where controllers are reused and instantiated in many
places, we provide an optional keyword argument to let the user uniquely name
the instances for later referral.</p>
</div>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id8" id="mapping-backward" name="mapping-backward">4&nbsp;&nbsp;&nbsp;Mapping Backward</a></h1>
<p>One problem with web applications is that due to the nature of the web
application frameworks, they tend to be rather static and difficult to change.
URLs are cross-referenced from page templates and sometimes build
programmatically, and it can be tricky to move resources around.</p>
<p>A solution for this is to let the URL construction be taken care of by the
resource system itself, mapping from the leaf of the URL back to the root, thus
re-constructing the original resource.</p>
<p>We can identify individual resources by using unique strings (e.g. <tt class="docutils literal"><span class="pre">//balance</span></tt>
the user account balance page) and then asking a central URL mapping service to
create the URLs for us to insert in web pages.  This process must require all
the parameters of the function to call, in order to insert them in their
appropriate place.</p>
<p>A web application build this way can be completely rearranged without breaking.</p>
<p>However, this flexibility makes using templates impossible.</p>
<div class="section">
<h2><a class="toc-backref" href="#id9" id="optimization-of-backmapping" name="optimization-of-backmapping">4.1&nbsp;&nbsp;&nbsp;Optimization of BackMapping</a></h2>
<ul class="simple">
<li>Ask each resource whether it is<ul>
<li>Static</li>
<li>A fixed name (e.g. user)</li>
<li>Programmatic (cannot optimize)</li>
</ul>
</li>
</ul>
<p>FIXME todo write docs</p>
<p>FIXME add callgraph thing, with a figure</p>
<div class="figure">
<img alt="callgraph.png" src="callgraph.png" />
<p class="caption">The inter-resource call graph for the demo application of this package.</p>
</div>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id10" id="selection-of-resource-ids" name="selection-of-resource-ids">4.2&nbsp;&nbsp;&nbsp;Selection of Resource Ids</a></h2>
<p>You should choose some kind of common string pattern for you resource ids, so
that if you decide to rename some of them at some point, for example when
reorganizing a site, simple text-based UNIX tools can do a wonderful job at
automating some of these replacments if they can be picked out easily.</p>
<p>The default naming transform</p>
<blockquote>
&#8230; describe <tt class="docutils literal"><span class="pre">&#64;&#64;&lt;ResourceName&gt;</span></tt> scheme</blockquote>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id11" id="static-maps" name="static-maps">4.3&nbsp;&nbsp;&nbsp;Static Maps</a></h2>
<p>Since we already have a global registry of URL maps that we use to generate our
URLs, we also provide the ability to map names to static and possibly external
URLs.  This is similar to Routes&#8217; &#8220;static named routes&#8221; feature.</p>
</div>
<div class="section">
<h2><a class="toc-backref" href="#id12" id="unique-identifiers" name="unique-identifiers">4.4&nbsp;&nbsp;&nbsp;Unique Identifiers</a></h2>
<p>FIXME do this, talk about the automatic conversion from the class names and the
possibility to identify instances.</p>
<blockquote>
<ul class="simple">
<li>We need to automatically compute these names from the names of the
classes, and a class attribute can be used on the classes to override that
as well as it should be able to be specified as a keyword argument on the
base class.</li>
</ul>
</blockquote>
</div>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id13" id="listing-available-resources-and-urls" name="listing-available-resources-and-urls">5&nbsp;&nbsp;&nbsp;Listing Available Resources and URLs</a></h1>
<p>One nice feature of our system is that we like to be able to get an entire list
of the URLs served by the system.  This is extremely useful, because:</p>
<ol class="arabic simple">
<li>We visually appreciate the entire list of documents which are offered to the
public.  We need this, because during development it is possible that
temporary resources are installed for debugging and later on forgotten.</li>
<li>Our test programs can automatically fetch this list (from a special resource
only served in testing mode) and can rebuild a mapper from it, so that they
are entirely independent of the application URL layout.</li>
</ol>
<p>(#. Can inspect the various security credentials that each URL requires.)</p>
<ul class="simple">
<li>FIXME mention pretty resource renderer and defaults</li>
</ul>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id14" id="embedding-security" name="embedding-security">6&nbsp;&nbsp;&nbsp;Embedding Security</a></h1>
<p>The URLs can be grouped so that they share security access privileges.  For
example, any URL beginning with <tt class="docutils literal"><span class="pre">/backstore</span></tt> could require administrative
privileges.</p>
<p>One way to do this</p>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id15" id="internal-redirects" name="internal-redirects">7&nbsp;&nbsp;&nbsp;Internal Redirects</a></h1>
<p>FIXME write it</p>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id16" id="support-for-debugging" name="support-for-debugging">8&nbsp;&nbsp;&nbsp;Support for Debugging</a></h1>
<p>FIXME write it</p>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id17" id="a-routes-like-interface" name="a-routes-like-interface">9&nbsp;&nbsp;&nbsp;A Routes-Like Interface</a></h1>
<p>FIXME answer what is &#8220;Routes&#8221;, add link</p>
<ul class="simple">
<li>FIXME provide a &#8220;connect&#8221; interface that is similar to Routes, but that
automatically creates all the required resources underneath with default
Folder objects and such.</li>
</ul>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id18" id="other" name="other">10&nbsp;&nbsp;&nbsp;(Other)</a></h1>
<p>Idea: in our resources traversal, we could put the query args together with the
parameters in the URL itself&#8230; they are really conceptually the same&#8230;  checks
would be added. FIXME TBD</p>
<ul class="simple">
<li>Document URL pattern format</li>
</ul>
<div class="section">
<h2><a class="toc-backref" href="#id19" id="writing-tests" name="writing-tests">10.1&nbsp;&nbsp;&nbsp;Writing Tests</a></h2>
<ul class="simple">
<li>Matching against a known URL</li>
</ul>
</div>
</div>
</div>
</body>
</html>
